# راه‌اندازی ResolverBot با Docker

## پیش‌نیاز

- نصب **Docker** و **Docker Compose**
- در ویندوز: اسکریپت را در **Git Bash** یا **WSL** اجرا کنید (`bash docker-setup.sh`)
- دو دامنه (یا ساب‌دامین) برای وب‌هوک ربات و phpMyAdmin که به IP سرور اشاره کنند

## اجرای یک‌باره (راه‌اندازی اول)

```bash
chmod +x docker-setup.sh
./docker-setup.sh
```

اسکریپت به ترتیب می‌پرسد:

1. **دامنه وب‌هوک** (مثلاً `bot.example.com`) — آدرسی که تلگرام به آن درخواست می‌فرستد
2. **دامنه phpMyAdmin** (مثلاً `pma.example.com`)
3. **توکن ربات** از @BotFather
4. **پورت داخلی اپ** (پیش‌فرض: 3000)
5. **نام ربات** در پیام استارت (پیش‌فرض: فیلترشکن)
6. **آیدی عددی ادمین اول**
7. **ادمین دیگر؟** (y/n) و در صورت بله، آیدی ادمین بعدی (تا هر تعداد)
8. **رمز دیتابیس** (برای root مای‌اسکیول و اتصال اپ)

بعد از آن:

- فایل **`.env`** ساخته می‌شود
- کانفیگ **nginx** در `docker/nginx/conf.d/default.conf` نوشته می‌شود
- **دیتابیس** توسط اپ (در اولین اجرا) ساخته و جداولش ایجاد می‌شود
- **`docker compose up -d --build`** اجرا می‌شود

## سرویس‌ها

| سرویس      | توضیح                          |
|-----------|---------------------------------|
| **app**   | ربات Node.js (ورژن 22.14.0)     |
| **db**    | MySQL 8                         |
| **phpmyadmin** | رابط وب برای دیتابیس      |
| **nginx** | پروکسی وب‌هوک و phpMyAdmin روی پورت 80 |

## دستورات مفید

```bash
# مشاهده لاگ ربات
docker compose logs -f app

# ریستارت ربات
docker compose restart app

# توقف همه
docker compose down

# اجرای مجدد (بدون اجرای اسکریپت)
docker compose up -d
```

## HTTPS (اختیاری)

برای استفاده از **https** برای وب‌هوک:

1. با **certbot** (یا روش دیگر) گواهی برای دامنه‌ها بگیرید و آن را در nginx فعال کنید (مثلاً volume برای `/etc/letsencrypt` و یک سرور با `listen 443 ssl`).
2. در **`.env`** مقدار `WEBHOOK` را به `https://دامنه-وب‌هوک` تغییر دهید.
3. یک‌بار ربات را ریستارت کنید: `docker compose restart app`

## نسخه Node و npm

تصویر داکر از **`node:22.14.0-alpine`** استفاده می‌کند (Node v22.14.0؛ npm همراه همان تصویر است).
